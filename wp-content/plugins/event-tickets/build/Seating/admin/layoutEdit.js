(()=>{"use strict";var e,t={"0zfD":(e,t,n)=>{n.d(t,{ACTION_DELETE_RESERVATIONS:()=>E,ACTION_RESERVATIONS_UPDATED_FROM_SEAT_TYPES:()=>y,ACTION_SEAT_TYPES_UPDATED:()=>m,ACTION_SEAT_TYPE_DELETED:()=>A,ajaxNonce:()=>s,ajaxUrl:()=>o});const a=window?.tec?.tickets?.seating?.ajaxData,{ajaxUrl:o,ajaxNonce:s,ACTION_GET_SEAT_TYPES_BY_LAYOUT_ID:r,ACTION_INVALIDATE_MAPS_LAYOUTS_CACHE:i,ACTION_INVALIDATE_LAYOUTS_CACHE:c,ACTION_DELETE_MAP:d,ACTION_DELETE_LAYOUT:_,ACTION_ADD_NEW_LAYOUT:u,ACTION_DUPLICATE_LAYOUT:l,ACTION_POST_RESERVATIONS:f,ACTION_CLEAR_RESERVATIONS:T,ACTION_FETCH_ATTENDEES:p,ACTION_DELETE_RESERVATIONS:E,ACTION_SEAT_TYPES_UPDATED:m,ACTION_SEAT_TYPE_DELETED:A,ACTION_RESERVATIONS_UPDATED_FROM_SEAT_TYPES:y,ACTION_RESERVATION_CREATED:O,ACTION_RESERVATION_UPDATED:g,ACTION_EVENT_LAYOUT_UPDATED:h,ACTION_REMOVE_EVENT_LAYOUT:S}=a},He5b:(e,t,n)=>{n.r(t),n.d(t,{goToAssociatedEvents:()=>Y,init:()=>M});const a=window.tec.tickets.seating.serviceData,o=a.baseUrl.replace(/\/$/,""),s=a.mapsHomeUrl.replace(/\/$/,""),r=a.layoutsHomeUrl.replace(/\/$/,""),i=a.associatedEventsUrl.replace(/\/$/,"");function c(){return o.split("?")[0]}const d="app_postmessage_ready",_="host_postmessage_ready",u="app_postmessage_set_element_height",l="app_postmessage_map_created_updated",f="app_postmessage_layout_created_updated",T="app_postmessage_seat_type_created_updated",p="app_postmessage_seat_types_updated",E="app_postmessage_seat_type_deleted",m="app_postmessage_reservations_deleted",A="app_postmessage_reservations_updated_following_seat_types",y="app_postmessage_goto_associated_events",O="app_postmessage_goto_maps_home",g="app_postmessage_goto_layouts_home";var h=n("0zfD");function S(e){console.debug("Message received from service",e)}async function w(){const e=new URL(h.ajaxUrl);return e.searchParams.set("_ajax_nonce",h.ajaxNonce),e.searchParams.set("action","tec_tickets_seating_service_invalidate_layouts_cache"),200===(await fetch(e.toString(),{method:"POST"})).status||(console.error("Invalidation of layouts cache failed, clean the transients manually to fetch up-to-date layouts from the service."),!1)}const N={ready:!1,establishingReadiness:!1,actionsMap:{default:S,[l]:function(){!async function(){const e=new URL(h.ajaxUrl);e.searchParams.set("_ajax_nonce",h.ajaxNonce),e.searchParams.set("action","tec_tickets_seating_service_invalidate_maps_layouts_cache"),200===(await fetch(e.toString(),{method:"POST"})).status||console.error("Invalidation of maps and layouts cache failed, clean the transients manually to fetch up-to-date maps and layouts from the service.")}()},[f]:function(){w()},[T]:function(){w()},[O]:function(){s?window.location.href=s:console.error("Maps home url not found")},[g]:function(){r?window.location.href=r:console.error("Layouts home url not found")}},token:null};function v(e,t){N.actionsMap[e]=t}let I=[];function k(){if(0===I.length)return;const[e,t,n]=I[0],a=function(e){return async t=>{await e(t),I.shift(),k()}}(t);a(n.data.data)}function P(e){if(e.origin!==c()||!e.data.token||e.data.token!==N.token)return;const t=e.data.action;if(!t)return void console.error("No action found in message");const n=function(e){return N.actionsMap[e]||N.actionsMap.default||S}(t);I.push([t,n,e]),I.length>1||k()}async function D(e){let t;!function(e){const t=e.closest("[data-token]");if(!t)return void console.error("No token provider found in iframe element");const n=t.dataset.token;n?(function(e){N.token=e}(n),window.addEventListener("message",P)):console.error("No token found in token provider element")}(e);const n=new Promise(((n,o)=>{t=o,v(d,(()=>{var t;t=d,delete N.actionsMap[t],N.ready=true,N.establishingReadiness=false,function(e,t){const n=e.closest("[data-token]").dataset.token;n?e.contentWindow.postMessage({action:t,token:n,data:null},c()):console.error("No token found in iframe element")}(e,_),clearTimeout(a),console.debug("Readiness established."),n()}))})),a=setTimeout((()=>{t(new Error("Connection to service timed out"))}),3e3);return e.src=e.dataset.src,n}const{_x}=wp.i18n;async function C(e){if(!e)return!1;const t=e.closest(".tec-tickets-seating__iframe-container");if(!t)return!1;if(!t.dataset.token){const e=_x("Ephemeral token not found in iframe element.","Error message","event-tickets");return function(e){const t=document.getElementById("tec-tickets-seating-notice");(function(e){e&&(e.style.display="none",e.style.visibility="hidden")})(t),function(e,t){if(!e)return;const n=e.classList;n.remove("notice-success"),n.remove("notice-warning"),n.remove("notice-error"),n.add(t)}(t,"notice-error"),function(e,t){e&&(e.innerHTML="<p>"+t+"</p>")}(t,e),function(e){e&&(e.style.display="block",e.style.visibility="visible")}(t)}(t.dataset.error||e),!1}return await D(e),!0}function R(e){return(e=e||document).querySelector(".tec-tickets-seating__iframe-container iframe")}var b=n("Lc+o");async function U(e){const t=e?.seatTypes||[];if(!(Array.isArray(t)&&t.length>0))return!1;const n=new URL(h.ajaxUrl);n.searchParams.set("_ajax_nonce",h.ajaxNonce),n.searchParams.set("action",h.ACTION_SEAT_TYPES_UPDATED);const a=await fetch(n.toString(),{method:"POST",body:JSON.stringify(t)});if(!a.ok)return!1;const o=await a.json();return o?.data||{updatedSeatTypes:0,updatedTickets:0,updatedPosts:0}}async function j(e){if(!e?.deletedId)return!1;const t=new URL(h.ajaxUrl);t.searchParams.set("_ajax_nonce",h.ajaxNonce),t.searchParams.set("action",h.ACTION_SEAT_TYPE_DELETED);const n=await fetch(t.toString(),{method:"POST",body:JSON.stringify(e)});if(!n.ok)return!1;const a=await n.json();return a?.data||!1}async function L(e){const t=e?.ids||[];if(!(Array.isArray(t)&&t.length>0))return 0;const n=new URL(h.ajaxUrl);n.searchParams.set("_ajax_nonce",h.ajaxNonce),n.searchParams.set("action",h.ACTION_DELETE_RESERVATIONS);const a=await fetch(n.toString(),{method:"POST",body:JSON.stringify(t)});if(!a.ok)return!1;const o=await a.json();return o?.data?.numberDeleted||0}async function x(e){const t=e?.updated||{};if(!t||0===Object.keys(t).length)return 0;const n=new URL(h.ajaxUrl);n.searchParams.set("_ajax_nonce",h.ajaxNonce),n.searchParams.set("action",h.ACTION_RESERVATIONS_UPDATED_FROM_SEAT_TYPES);const a=await fetch(n.toString(),{method:"POST",body:JSON.stringify(t)});if(!a.ok)return!1;const o=await a.json();return o?.data||{updatedAttendees:0}}function Y(e){var t;e.layoutId&&(0,b.redirectTo)((t=e.layoutId)?`${i}&layout=${t}`:i,!0)}async function M(e){e=e||document,v(u,(t=>function(e,t){R(t).style.height=e.height+"px"}(t,e))),v(m,L),v(p,U),v(E,j),v(A,x),v(y,Y),await async function(e){return await C(e),e}(R(e))}(0,b.onReady)((()=>{M(document)}))},"Lc+o":(e,t,n)=>{n.d(t,{onReady:()=>a,redirectTo:()=>o});const a=e=>{"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)};function o(e,t=!1){t?window.open(e,"_blank","noopener,noreferrer"):window.location.href=e}}},n={};function a(e){var o=n[e];if(void 0!==o)return o.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=(t,n,o,s)=>{if(!n){var r=1/0;for(_=0;_<e.length;_++){for(var[n,o,s]=e[_],i=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(a.O).every((e=>a.O[e](n[c])))?n.splice(c--,1):(i=!1,s<r&&(r=s));if(i){e.splice(_--,1);var d=o();void 0!==d&&(t=d)}}return t}s=s||0;for(var _=e.length;_>0&&e[_-1][2]>s;_--)e[_]=e[_-1];e[_]=[n,o,s]},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={1490:0,4193:0,8797:0,9769:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var o,s,[r,i,c]=n,d=0;if(r.some((t=>0!==e[t]))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(c)var _=c(a)}for(t&&t(n);d<r.length;d++)s=r[d],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(_)},n=globalThis.webpackChunkevent_tickets=globalThis.webpackChunkevent_tickets||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=a.O(void 0,[9769],(()=>a("He5b")));o=a.O(o),window.tec=window.tec||{},window.tec.tickets=window.tec.tickets||{},window.tec.tickets.seating=window.tec.tickets.seating||{},window.tec.tickets.seating.admin=window.tec.tickets.seating.admin||{},window.tec.tickets.seating.admin.layoutEdit=o})();