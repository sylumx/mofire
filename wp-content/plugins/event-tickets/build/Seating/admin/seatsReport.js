(()=>{"use strict";var e,t={"0zfD":(e,t,a)=>{a.d(t,{ACTION_DELETE_RESERVATIONS:()=>E,ACTION_FETCH_ATTENDEES:()=>T,ACTION_RESERVATION_CREATED:()=>O,ACTION_RESERVATION_UPDATED:()=>y,ajaxNonce:()=>s,ajaxUrl:()=>o});const n=window?.tec?.tickets?.seating?.ajaxData,{ajaxUrl:o,ajaxNonce:s,ACTION_GET_SEAT_TYPES_BY_LAYOUT_ID:r,ACTION_INVALIDATE_MAPS_LAYOUTS_CACHE:c,ACTION_INVALIDATE_LAYOUTS_CACHE:i,ACTION_DELETE_MAP:d,ACTION_DELETE_LAYOUT:_,ACTION_ADD_NEW_LAYOUT:u,ACTION_DUPLICATE_LAYOUT:l,ACTION_POST_RESERVATIONS:f,ACTION_CLEAR_RESERVATIONS:p,ACTION_FETCH_ATTENDEES:T,ACTION_DELETE_RESERVATIONS:E,ACTION_SEAT_TYPES_UPDATED:m,ACTION_SEAT_TYPE_DELETED:h,ACTION_RESERVATIONS_UPDATED_FROM_SEAT_TYPES:A,ACTION_RESERVATION_CREATED:O,ACTION_RESERVATION_UPDATED:y,ACTION_EVENT_LAYOUT_UPDATED:g,ACTION_REMOVE_EVENT_LAYOUT:w}=n},"Lc+o":(e,t,a)=>{a.d(t,{onReady:()=>n});const n=e=>{"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}},ZUAl:(e,t,a)=>{a.r(t),a.d(t,{fetchAndSendAttendeeBatch:()=>B,fetchAttendees:()=>V,handleReservationCreated:()=>$,handleReservationUpdated:()=>F,init:()=>z,sendAttendeesToService:()=>Y,updateAttendeeReservation:()=>H});const n=window.tec.tickets.seating.serviceData,o=n.baseUrl.replace(/\/$/,""),s=n.mapsHomeUrl.replace(/\/$/,""),r=n.layoutsHomeUrl.replace(/\/$/,"");function c(){return o.split("?")[0]}n.associatedEventsUrl.replace(/\/$/,"");const i="app_postmessage_ready",d="app_postmessage_ready_for_data",_="host_postmessage_ready",u="host_postmessage_seat_type_tickets",l="app_postmessage_map_created_updated",f="app_postmessage_layout_created_updated",p="app_postmessage_seat_type_created_updated",T="app_postmessage_reservations_deleted",E="app_postmessage_reservation_updated",m="app_postmessage_reservation_created",h="app_postmessage_goto_maps_home",A="app_postmessage_goto_layouts_home",O="host_postmessage_event_attendees",y="host_postmessage_attendee_update";var g=a("0zfD");function w(e){console.debug("Message received from service",e)}async function N(){const e=new URL(g.ajaxUrl);return e.searchParams.set("_ajax_nonce",g.ajaxNonce),e.searchParams.set("action","tec_tickets_seating_service_invalidate_layouts_cache"),200===(await fetch(e.toString(),{method:"POST"})).status||(console.error("Invalidation of layouts cache failed, clean the transients manually to fetch up-to-date layouts from the service."),!1)}const v={ready:!1,establishingReadiness:!1,actionsMap:{default:w,[l]:function(){!async function(){const e=new URL(g.ajaxUrl);e.searchParams.set("_ajax_nonce",g.ajaxNonce),e.searchParams.set("action","tec_tickets_seating_service_invalidate_maps_layouts_cache"),200===(await fetch(e.toString(),{method:"POST"})).status||console.error("Invalidation of maps and layouts cache failed, clean the transients manually to fetch up-to-date maps and layouts from the service.")}()},[f]:function(){N()},[p]:function(){N()},[h]:function(){s?window.location.href=s:console.error("Maps home url not found")},[A]:function(){r?window.location.href=r:console.error("Layouts home url not found")}},token:null};function S(e,t){v.actionsMap[e]=t}function I(e){delete v.actionsMap[e]}let R=[];function k(e,t,a){const n=e.closest("[data-token]").dataset.token;n?e.contentWindow.postMessage({action:t,token:n,data:a||null},c()):console.error("No token found in iframe element")}function C(){if(0===R.length)return;const[e,t,a]=R[0],n=function(e){return async t=>{await e(t),R.shift(),C()}}(t);n(a.data.data)}function D(e){if(e.origin!==c()||!e.data.token||e.data.token!==v.token)return;const t=e.data.action;if(!t)return void console.error("No action found in message");const a=function(e){return v.actionsMap[e]||v.actionsMap.default||w}(t);R.push([t,a,e]),R.length>1||C()}async function P(e){let t;!function(e){const t=e.closest("[data-token]");if(!t)return void console.error("No token provider found in iframe element");const a=t.dataset.token;a?(function(e){v.token=e}(a),window.addEventListener("message",D)):console.error("No token found in token provider element")}(e);const a=new Promise(((a,o)=>{t=o,S(i,(()=>{I(i),v.ready=true,v.establishingReadiness=false,k(e,_),clearTimeout(n),console.debug("Readiness established."),a()}))})),n=setTimeout((()=>{t(new Error("Connection to service timed out"))}),3e3);return e.src=e.dataset.src,a}const{_x}=wp.i18n;async function U(e){if(!e)return!1;const t=e.closest(".tec-tickets-seating__iframe-container");if(!t)return!1;if(!t.dataset.token){const e=_x("Ephemeral token not found in iframe element.","Error message","event-tickets");return function(e){const t=document.getElementById("tec-tickets-seating-notice");(function(e){e&&(e.style.display="none",e.style.visibility="hidden")})(t),function(e,t){if(!e)return;const a=e.classList;a.remove("notice-success"),a.remove("notice-warning"),a.remove("notice-error"),a.add(t)}(t,"notice-error"),function(e,t){e&&(e.innerHTML="<p>"+t+"</p>")}(t,e),function(e){e&&(e.style.display="block",e.style.visibility="visible")}(t)}(t.dataset.error||e),!1}return await P(e),!0}var L=a("Lc+o");const j=window?.tec?.tickets?.seating?.admin?.seatsReportData;async function b(e){const t=e?.ids||[];if(!(Array.isArray(t)&&t.length>0))return 0;const a=new URL(g.ajaxUrl);a.searchParams.set("_ajax_nonce",g.ajaxNonce),a.searchParams.set("action",g.ACTION_DELETE_RESERVATIONS);const n=await fetch(a.toString(),{method:"POST",body:JSON.stringify(t)});if(!n.ok)return!1;const o=await n.json();return o?.data?.numberDeleted||0}const{seatTypeMap:x,postId:M}=j;async function V(e){e=e||1;const t=new URL(g.ajaxUrl);t.searchParams.set("_ajax_nonce",g.ajaxNonce),t.searchParams.set("postId",M),t.searchParams.set("action",g.ACTION_FETCH_ATTENDEES),t.searchParams.set("currentBatch",e);const a=await fetch(t.toString(),{headers:{Accept:"application/json"}}),n=await a.json();if(200!==a.status)throw new Error(`Failed to fetch attendees for post ID ${M}. Status: ${a.status} - ${n?.data?.error}`);return{attendees:n?.data?.attendees||[],totalBatches:n?.data?.totalBatches||1,currentBatch:n?.data?.currentBatch||1,nextBatch:n?.data?.nextBatch||!1}}async function B(e,t,a,n){return V(t).then((o=>{const s=o?.nextBatch||!1,r={totalBatches:o?.totalBatches||1,currentBatch:t,attendees:o?.attendees||[]};k(e,O,r);const c=n+r.attendees.length;if(s)return B(e,s,a,c);a(c)}))}async function Y(e){return new Promise((t=>{B(e,1,t,0)}))}async function H(e){const t=new URL(g.ajaxUrl);t.searchParams.set("_ajax_nonce",g.ajaxNonce);const a=e.ticketId?g.ACTION_RESERVATION_CREATED:g.ACTION_RESERVATION_UPDATED;t.searchParams.set("action",a),t.searchParams.set("postId",M);const n=await fetch(t.toString(),{method:"POST",body:JSON.stringify(e)});if(!n.ok)return!1;const o=await n.json();return!!o.data&&o.data}async function $(e,t){const a=await H(t);return!!a&&(k(e,y,{attendee:a}),!0)}async function F(e,t){const a=await H(t);return!!a&&(k(e,y,{attendee:a}),!0)}async function z(e){const t=function(e){return(e=e||document).querySelector(".tec-tickets-seating__iframe-container iframe")}(e=e||document);if(!t)return!1;!function(e){S(d,(async()=>{I(d),k(e,u,x),await Y(e)})),S(m,(t=>$(e,t))),S(E,(t=>F(e,t))),S(T,b)}(t),await async function(e){return await U(e),e}(t)}(0,L.onReady)((()=>{z(document)}))}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var r=1/0;for(_=0;_<e.length;_++){for(var[a,o,s]=e[_],c=!0,i=0;i<a.length;i++)(!1&s||r>=s)&&Object.keys(n.O).every((e=>n.O[e](a[i])))?a.splice(i--,1):(c=!1,s<r&&(r=s));if(c){e.splice(_--,1);var d=o();void 0!==d&&(t=d)}}return t}s=s||0;for(var _=e.length;_>0&&e[_-1][2]>s;_--)e[_]=e[_-1];e[_]=[a,o,s]},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={1490:0,4193:0,6409:0,5981:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[r,c,i]=a,d=0;if(r.some((t=>0!==e[t]))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(i)var _=i(n)}for(t&&t(a);d<r.length;d++)s=r[d],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(_)},a=globalThis.webpackChunkevent_tickets=globalThis.webpackChunkevent_tickets||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[5981],(()=>n("ZUAl")));o=n.O(o),window.tec=window.tec||{},window.tec.tickets=window.tec.tickets||{},window.tec.tickets.seating=window.tec.tickets.seating||{},window.tec.tickets.seating.admin=window.tec.tickets.seating.admin||{},window.tec.tickets.seating.admin.seatsReport=o})();